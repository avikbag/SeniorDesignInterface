"use strict";angular.module("interfaceApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","chart.js","ngMaterial"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("interfaceApp").controller("MainCtrl",["$scope","$http","stats",function(a,b,c){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"];var d=[],e=[];return c.fetch().then(function(b){d=Object.keys(b.data.op_class),a.labels=d;for(var c=0;c<d.length-1;c++)e.push(b.data.op_class[d[c]]);a.data=e}),a.formatName=function(a){return function(a){return a}}(this),a.onDetail=function(a){return function(a){return console.log(a)}}(this),b.get("/flare_with_color.json").success(function(b){return function(b){return console.log(b),a.tree=b}}(this)),a.tree={}}]),angular.module("interfaceApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("interfaceApp").factory("stats",["$http",function(a){var b="src.json";return{fetch:function(){return a.get(b)}}}]),angular.module("interfaceApp").directive("treemap",function(){var a;return a=angular.element('<div class="angular-treemap"/>'),{restrict:"A",scope:{treemap:"=",name:"&",detail:"&",colorlow:"@",colormid:"@",colorhigh:"@"},compile:function(b){return function(b){return b.append(a)}}(this),controller:function(b){return["$scope",function(b){return b.find_color_range=function(a){var c,d,e,f,g;if(a.color<b.state.min_color&&(b.state.min_color=a.color),a.color>b.state.max_color&&(b.state.max_color=a.color),a.children){for(f=a.children,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(b.find_color_range(c));return g}},b.resize=function(){return b.state.width=$(b.state.parent).width(),b.state.height=.6*b.state.width,b.state.host.attr({width:b.state.width,height:b.state.height+20}),b.treemap.dx=b.state.width,b.treemap.dy=b.state.height,b.state.x=d3.scale.linear().domain([0,b.state.width]).range([0,b.state.width]),b.state.y=d3.scale.linear().domain([0,b.state.height]).range([0,b.state.height]),b.layout(b.treemap),b.state.svg.selectAll("rect.parent").call(function(a){return function(a){return b.rect(a)}}(this)),b.state.svg.selectAll("text.js-label").call(function(a){return function(a){return b.text(a)}}(this)),b.state.svg.selectAll("rect.child").call(function(a){return function(a){return b.rect(a)}}(this))},b.accumulate=function(a){return a.children?a.value=a.children.reduce(function(a){return function(a,c){return a+b.accumulate(c)}}(this),0):a.value},b.layout=function(a){var c,d,e,f,g;if(a.children){for(b.state.treemap.nodes({children:a.children}),f=a.children,g=[],d=0,e=f.length;e>d;d++)c=f[d],c.x=a.x+c.x*a.dx,c.y=a.y+c.y*a.dy,c.dx*=a.dx,c.dy*=a.dy,c.parent=a,g.push(b.layout(c));return g}},b.text=function(a){return a.attr({x:function(a){return b.state.x(a.x)+6},y:function(a){return b.state.y(a.y)+6}})},b.rect=function(a){return a.attr({fill:function(a){return b.state.color(a.color)},x:function(a){return b.state.x(a.x)+1},y:function(a){return b.state.y(a.y)+1},width:function(a){var c;return c=b.state.x(a.x+a.dx)-b.state.x(a.x)-2,c>=0?c:0},height:function(a){var c;return c=b.state.y(a.y+a.dy)-b.state.y(a.y)-2,c>=0?c:0}})},b.transition=function(a,c){var d,e,f;if(!b.state.transitioning&&a)return b.state.transitioning=!0,d=b.display(a),e=c.transition().duration(750),f=d.transition().duration(750),b.state.x.domain([a.x,a.x+a.dx]),b.state.y.domain([a.y,a.y+a.dy]),b.state.svg.style("shape-rendering",null),b.state.svg.selectAll(".depth").sort(function(a,b){return a.depth-b.depth}),d.selectAll("text").style("fill-opacity",0),e.selectAll("text").call(function(a){return b.text(a).style("fill-opacity",0)}),f.selectAll("text").call(function(a){return b.text(a).style("fill-opacity",1)}),e.selectAll("rect").call(function(a){return b.rect(a)}),f.selectAll("rect").call(function(a){return b.rect(a)}),e.remove().each("end",function(){return b.state.svg.style("shape-rendering","crispEdges"),b.state.transitioning=!1})},b.display=function(a){var c,d;return d=b.state.svg.insert("g",".grandparent").datum(a).attr("class","depth"),b.state.grandparent.datum(a.parent).on("click",function(a){return b.transition(a,d)}).select("text").text(b.formatName(a)),c=d.selectAll("g").data(a.children).enter().append("g"),c.filter(function(a){return a.children}).classed("children",!0).on("click",function(a){return b.transition(a,d)}),c.filter(function(a){return!a.children}).classed("children",!0).on("click",function(a){return b.curNode=a,b.$apply("detail({node:curNode})")}),c.selectAll(".child").data(function(a){return a.children||[a]}).enter().append("rect").attr("class","child").call(function(a){return b.rect(a)}),c.append("rect").attr("class","parent").style({"fill-opacity":.1,stroke:"black","stroke-width":"1","stroke-opacity":"0.8"}).call(function(a){return b.rect(a)}).append("title").text(function(a){return b.state.formatNumber(a.value)}),c.append("text").attr("class","js-label").attr("dy",".75em").text(function(a){return b.curName=a.name,b.name?b.$eval("name({name:curName})"):a.name}).call(function(a){return b.text(a)}),c},b.formatName=function(a){return a.parent?b.formatName(a.parent)+"."+a.name:a.name},b.state={margin:{left:0,top:20},parent:a},b.state.width=$(a).width(),b.state.height=.6*b.state.width,b.state.ratio=b.state.height/b.state.width*.5*(1+Math.sqrt(5)),b.$watch("treemap",function(a,c){var d;if(a!==c&&c)return $(b.state.parent).empty(),b.state.min_color=1e4,b.state.max_color=-1e4,b.find_color_range(b.treemap),d=[b.state.min_color,b.state.min_color+(b.state.max_color-b.state.min_color)/2,b.state.max_color],null==b.colorlow&&(b.colorlow="red"),null==b.colormid&&(b.colormid="white"),null==b.colorhigh&&(b.colorhigh="green"),b.state.color=d3.scale.linear().domain(d).range([b.colorlow,b.colormid,b.colorhigh]),b.state.treemap=d3.layout.treemap().children(function(a,b){return b?null:a.children}).sort(function(a,b){return a.value-b.value}).ratio(b.state.ratio).round(!1).sticky(!1),b.state.host=d3.select(b.state.parent[0]).append("svg"),b.state.svg=b.state.host.append("g").attr("transform","translate("+b.state.margin.left+","+b.state.margin.top+")").style("shape-rendering","crispEdges"),b.state.grandparent=b.state.svg.append("g").attr("class","grandparent"),b.state.grandparent.append("rect").attr({y:-b.state.margin.top,width:"100%",height:b.state.margin.top+5}),b.state.grandparent.append("text").attr({x:6,y:6-b.state.margin.top,dy:"0.75em"}),b.treemap.x=b.treemap.y=0,b.treemap.depth=0,b.state.transitioning=void 0,b.state.formatNumber=d3.format(",d"),b.treemap.dx=b.state.width,b.treemap.dy=b.state.height,b.state.x=d3.scale.linear().domain([0,b.state.width]).range([0,b.state.width]),b.state.y=d3.scale.linear().domain([0,b.state.height]).range([0,b.state.height]),b.accumulate(b.treemap),b.layout(b.treemap),b.display(b.treemap),b.resize()})}]}(this)}}),angular.module("interfaceApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/main.html",'<div class="jumbotron"> <h1>\'Allo, \'Allo!</h1> <canvas id="doughnut" class="chart chart-doughnut" chart-data="data" chart-labels="labels"></canvas> <div treemap="tree" name="formatName(name)" detail="onDetail(node)" colorlow="blue" colormid="white" colorhigh="yellow"></div> </div>')}]);